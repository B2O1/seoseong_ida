<div class="home-search-search-container">
  <form id="home-search-searchForm">
    <input class="home-search-search-bar" type="text" placeholder="어떤 카페가 좋을까?" />
    <button type="submit">🔍 검색</button>
  </form>

  <main id="home-search-searchSuggestions" class="home-search-suggestion-box home-search-hidden">
    <div id="home-search-container_who">
      <h3>누구와 함께 하나요?</h3>
      <div>
        <button class="home-search-tag-btn">🧑‍🤝‍🧑 친구랑 <span>(14)</span></button>
        <button class="home-search-tag-btn">👩‍❤️‍👨 연인이랑 <span>(14)</span></button>
        <button class="home-search-tag-btn">👨‍👩‍👧‍👦 가족이랑 <span>(9)</span></button>
        <button class="home-search-tag-btn">🐶 반려동물과 함께 <span>(7)</span></button>
        <button class="home-search-tag-btn">👤 혼자서 <span>(7)</span></button>
        <button class="home-search-tag-btn">👥 단체로 <span>(4)</span></button>
        <button class="home-search-tag-btn">🌍 외국인 친구와 <span>(3)</span></button>
      </div>
    </div>

    <div id="home-search-container_what">
      <h3>무엇을 하나요?</h3>
      <div>
        <button class="home-search-tag-btn">🍰 디저트 먹기 <span>(14)</span></button>
        <button class="home-search-tag-btn">☕ 커피 마시기 <span>(14)</span></button>
        <button class="home-search-tag-btn">💻 공부하기 <span>(9)</span></button>
        <button class="home-search-tag-btn">📖 책 읽기 <span>(7)</span></button>
        <button class="home-search-tag-btn">💬 수다 떨기 <span>(7)</span></button>
        <button class="home-search-tag-btn">🏡 한옥 감성 즐기기 <span>(4)</span></button>
        <button class="home-search-tag-btn">🐾 반려동물과 함께하기 <span>(3)</span></button>
        <button class="home-search-tag-btn">💰 가성비 좋은 곳 찾기 <span>(3)</span></button>
        <button class="home-search-tag-btn">🔍 숨겨진 카페 찾기 <span>(3)</span></button>
        <button class="home-search-tag-btn">🚻 화장실 청결한 곳 찾기 <span>(3)</span></button>
      </div>
    </div>

    <div id="home-search-container_special">
      <h3>분위기와 특징</h3>
      <div>
        <button class="home-search-tag-btn">✨ 분위기 좋은 <span>(4)</span></button>
        <button class="home-search-tag-btn">🏡 한옥 감성 <span>(3)</span></button>
        <button class="home-search-tag-btn">🍽️ 빵이 맛있는 <span>(3)</span></button>
        <button class="home-search-tag-btn">🍰 케이크가 맛있는 <span>(3)</span></button>
        <button class="home-search-tag-btn">☕ 커피가 맛있는 <span>(3)</span></button>
        <button class="home-search-tag-btn">📚 공부하기 좋은 <span>(4)</span></button>
        <button class="home-search-tag-btn">🛋️ 쾌적한 <span>(3)</span></button>
        <button class="home-search-tag-btn">🎶 조용한 <span>(3)</span></button>
        <button class="home-search-tag-btn">🥇 올타임 베스트 <span>(3)</span></button>
        <button class="home-search-tag-btn">🚀 주말 피해야 하는 <span>(3)</span></button>
        <button class="home-search-tag-btn">🕵️ 숨겨진 나만의 공간 <span>(3)</span></button>
        <button class="home-search-tag-btn">🐾 반려동물과 함께 <span>(3)</span></button>
        <button class="home-search-tag-btn">🥛 우유 변경 가능 <span>(3)</span></button>
      </div>
    </div>
  </main>
</div>
<script>
  // Django에서 URL 이름으로 실제 URL 가져오기
  const searchBaseUrl = "{% url 'search' %}";
  const loginUrl = "{% url 'login' %}";

  document.addEventListener('DOMContentLoaded', function () {
    const popup = document.getElementById('home-search-searchSuggestions');
    const searchInput = document.querySelector('.home-search-search-bar');
    const searchForm = document.getElementById('home-search-searchForm');

    let selectedValues = {
      who: '',
      what: '',
      special: '',
    };

    function showSuggestions() {
      if (popup) {
        popup.classList.remove('home-search-hidden');
        popup.style.display = 'block';
      }
    }

    function hideSuggestions() {
      if (popup) {
        popup.classList.add('home-search-hidden');
        popup.style.display = 'none';
      }
    }

    if (searchInput) {
      searchInput.addEventListener('click', function (event) {
        event.stopPropagation();
        console.log("Search input clicked");
        showSuggestions();
      });
    }

    document.addEventListener('click', function (event) {
      if (!popup.contains(event.target) && event.target !== searchInput) {
        hideSuggestions();
      }
    });

    if (popup) {
      popup.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }

    const categories = {
      home-search-container_who: 'who',
      home-search-container_what: 'what',
      home-search-container_special: 'special',
    };

    Object.keys(categories).forEach((categoryId) => {
      const category = document.getElementById(categoryId);
      if (category) {
        category.addEventListener('click', function (event) {
          if (event.target.classList.contains('home-search-tag-btn')) {
            event.stopPropagation();
            category.querySelectorAll('.home-search-tag-btn').forEach((btn) => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedValues[categories[categoryId]] = event.target.innerText.trim();
          }
        });
      }
    });
    
    if (searchForm) {
      searchForm.addEventListener('submit', function (event) {
        event.preventDefault();

        const searchQuery = searchInput.value.trim();
        const queryParams = new URLSearchParams();

        if (searchQuery) queryParams.append('query', searchQuery);
        if (selectedValues.who) queryParams.append('who', selectedValues.who);
        if (selectedValues.what) queryParams.append('what', selectedValues.what);
        if (selectedValues.special) queryParams.append('special', selectedValues.special);

        const finalURL = searchBaseUrl + '?' + queryParams.toString();
        console.log('이동할 URL:', finalURL);

        window.top.location.href = finalURL;
      });
    }

    // 로그인 버튼 이동 예시
    const loginButton = document.getElementById('loginButton');
    if (loginButton) {
      loginButton.addEventListener('click', function () {
        window.location.href = loginUrl;
      });
    }
  });
</script>

