<div class="home-search-search-container">
  <form id="home-search-searchForm">
    <input class="home-search-search-bar" type="text" placeholder="ì–´ë–¤ ì¹´í˜ê°€ ì¢‹ì„ê¹Œ?" />
    <button type="submit">ğŸ” ê²€ìƒ‰</button>
  </form>

  <main id="home-search-searchSuggestions" class="home-search-suggestion-box home-search-hidden">
    <div id="home-search-container_who">
      <h3>ëˆ„êµ¬ì™€ í•¨ê»˜ í•˜ë‚˜ìš”?</h3>
      <div>
        <button class="home-search-tag-btn">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì¹œêµ¬ë‘ <span>(14)</span></button>
        <button class="home-search-tag-btn">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ì—°ì¸ì´ë‘ <span>(14)</span></button>
        <button class="home-search-tag-btn">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ì´ë‘ <span>(9)</span></button>
        <button class="home-search-tag-btn">ğŸ¶ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ <span>(7)</span></button>
        <button class="home-search-tag-btn">ğŸ‘¤ í˜¼ìì„œ <span>(7)</span></button>
        <button class="home-search-tag-btn">ğŸ‘¥ ë‹¨ì²´ë¡œ <span>(4)</span></button>
        <button class="home-search-tag-btn">ğŸŒ ì™¸êµ­ì¸ ì¹œêµ¬ì™€ <span>(3)</span></button>
      </div>
    </div>

    <div id="home-search-container_what">
      <h3>ë¬´ì—‡ì„ í•˜ë‚˜ìš”?</h3>
      <div>
        <button class="home-search-tag-btn">ğŸ° ë””ì €íŠ¸ ë¨¹ê¸° <span>(14)</span></button>
        <button class="home-search-tag-btn">â˜• ì»¤í”¼ ë§ˆì‹œê¸° <span>(14)</span></button>
        <button class="home-search-tag-btn">ğŸ’» ê³µë¶€í•˜ê¸° <span>(9)</span></button>
        <button class="home-search-tag-btn">ğŸ“– ì±… ì½ê¸° <span>(7)</span></button>
        <button class="home-search-tag-btn">ğŸ’¬ ìˆ˜ë‹¤ ë–¨ê¸° <span>(7)</span></button>
        <button class="home-search-tag-btn">ğŸ¡ í•œì˜¥ ê°ì„± ì¦ê¸°ê¸° <span>(4)</span></button>
        <button class="home-search-tag-btn">ğŸ¾ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜í•˜ê¸° <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ’° ê°€ì„±ë¹„ ì¢‹ì€ ê³³ ì°¾ê¸° <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ” ìˆ¨ê²¨ì§„ ì¹´í˜ ì°¾ê¸° <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸš» í™”ì¥ì‹¤ ì²­ê²°í•œ ê³³ ì°¾ê¸° <span>(3)</span></button>
      </div>
    </div>

    <div id="home-search-container_special">
      <h3>ë¶„ìœ„ê¸°ì™€ íŠ¹ì§•</h3>
      <div>
        <button class="home-search-tag-btn">âœ¨ ë¶„ìœ„ê¸° ì¢‹ì€ <span>(4)</span></button>
        <button class="home-search-tag-btn">ğŸ¡ í•œì˜¥ ê°ì„± <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ½ï¸ ë¹µì´ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ° ì¼€ì´í¬ê°€ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="home-search-tag-btn">â˜• ì»¤í”¼ê°€ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ“š ê³µë¶€í•˜ê¸° ì¢‹ì€ <span>(4)</span></button>
        <button class="home-search-tag-btn">ğŸ›‹ï¸ ì¾Œì í•œ <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ¶ ì¡°ìš©í•œ <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ¥‡ ì˜¬íƒ€ì„ ë² ìŠ¤íŠ¸ <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸš€ ì£¼ë§ í”¼í•´ì•¼ í•˜ëŠ” <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ•µï¸ ìˆ¨ê²¨ì§„ ë‚˜ë§Œì˜ ê³µê°„ <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ¾ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ <span>(3)</span></button>
        <button class="home-search-tag-btn">ğŸ¥› ìš°ìœ  ë³€ê²½ ê°€ëŠ¥ <span>(3)</span></button>
      </div>
    </div>
  </main>
</div>
<script>
  // Djangoì—ì„œ URL ì´ë¦„ìœ¼ë¡œ ì‹¤ì œ URL ê°€ì ¸ì˜¤ê¸°
  const searchBaseUrl = "{% url 'search' %}";
  const loginUrl = "{% url 'login' %}";

  document.addEventListener('DOMContentLoaded', function () {
    const popup = document.getElementById('home-search-searchSuggestions');
    const searchInput = document.querySelector('.home-search-search-bar');
    const searchForm = document.getElementById('home-search-searchForm');

    let selectedValues = {
      who: '',
      what: '',
      special: '',
    };

    function showSuggestions() {
      if (popup) {
        popup.classList.remove('home-search-hidden');
        popup.style.display = 'block';
      }
    }

    function hideSuggestions() {
      if (popup) {
        popup.classList.add('home-search-hidden');
        popup.style.display = 'none';
      }
    }

    if (searchInput) {
      searchInput.addEventListener('click', function (event) {
        event.stopPropagation();
        console.log("Search input clicked");
        showSuggestions();
      });
    }

    document.addEventListener('click', function (event) {
      if (!popup.contains(event.target) && event.target !== searchInput) {
        hideSuggestions();
      }
    });

    if (popup) {
      popup.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }

    const categories = {
      home-search-container_who: 'who',
      home-search-container_what: 'what',
      home-search-container_special: 'special',
    };

    Object.keys(categories).forEach((categoryId) => {
      const category = document.getElementById(categoryId);
      if (category) {
        category.addEventListener('click', function (event) {
          if (event.target.classList.contains('home-search-tag-btn')) {
            event.stopPropagation();
            category.querySelectorAll('.home-search-tag-btn').forEach((btn) => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedValues[categories[categoryId]] = event.target.innerText.trim();
          }
        });
      }
    });
    
    if (searchForm) {
      searchForm.addEventListener('submit', function (event) {
        event.preventDefault();

        const searchQuery = searchInput.value.trim();
        const queryParams = new URLSearchParams();

        if (searchQuery) queryParams.append('query', searchQuery);
        if (selectedValues.who) queryParams.append('who', selectedValues.who);
        if (selectedValues.what) queryParams.append('what', selectedValues.what);
        if (selectedValues.special) queryParams.append('special', selectedValues.special);

        const finalURL = searchBaseUrl + '?' + queryParams.toString();
        console.log('ì´ë™í•  URL:', finalURL);

        window.top.location.href = finalURL;
      });
    }

    // ë¡œê·¸ì¸ ë²„íŠ¼ ì´ë™ ì˜ˆì‹œ
    const loginButton = document.getElementById('loginButton');
    if (loginButton) {
      loginButton.addEventListener('click', function () {
        window.location.href = loginUrl;
      });
    }
  });
</script>

