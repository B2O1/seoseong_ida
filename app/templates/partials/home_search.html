<div class="home-search-search-container">
  <form id="home-search-searchForm">
    <input class="home-search-search-bar" type="text" placeholder="ì–´ë–¤ ì¹´í˜ê°€ ì¢‹ì„ê¹Œ?" />
    <button class="home-search-button-grid" type="submit">ğŸ” ê²€ìƒ‰</button>
  </form>

  <main id="home-search-searchSuggestions" class="suggestion-box hidden">
    <div id="home-search-container_who">
      <h3>ëˆ„êµ¬ì™€ í•¨ê»˜ í•˜ë‚˜ìš”?</h3>
      <div>
        <button class="tag-btn">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì¹œêµ¬ë‘ <span>(14)</span></button>
        <button class="tag-btn">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ì—°ì¸ì´ë‘ <span>(14)</span></button>
        <button class="tag-btn">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ì´ë‘ <span>(9)</span></button>
        <button class="tag-btn">ğŸ¶ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ <span>(7)</span></button>
        <button class="tag-btn">ğŸ‘¤ í˜¼ìì„œ <span>(7)</span></button>
        <button class="tag-btn">ğŸ‘¥ ë‹¨ì²´ë¡œ <span>(4)</span></button>
        <button class="tag-btn">ğŸŒ ì™¸êµ­ì¸ ì¹œêµ¬ì™€ <span>(3)</span></button>
      </div>
    </div>

    <div id="home-search-container_what">
      <h3>ë¬´ì—‡ì„ í•˜ë‚˜ìš”?</h3>
      <div>
        <button class="tag-btn">ğŸ° ë””ì €íŠ¸ ë¨¹ê¸° <span>(14)</span></button>
        <button class="tag-btn">â˜• ì»¤í”¼ ë§ˆì‹œê¸° <span>(14)</span></button>
        <button class="tag-btn">ğŸ’» ê³µë¶€í•˜ê¸° <span>(9)</span></button>
        <button class="tag-btn">ğŸ“– ì±… ì½ê¸° <span>(7)</span></button>
        <button class="tag-btn">ğŸ’¬ ìˆ˜ë‹¤ ë–¨ê¸° <span>(7)</span></button>
        <button class="tag-btn">ğŸ¡ í•œì˜¥ ê°ì„± ì¦ê¸°ê¸° <span>(4)</span></button>
        <button class="tag-btn">ğŸ¾ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜í•˜ê¸° <span>(3)</span></button>
        <button class="tag-btn">ğŸ’° ê°€ì„±ë¹„ ì¢‹ì€ ê³³ ì°¾ê¸° <span>(3)</span></button>
        <button class="tag-btn">ğŸ” ìˆ¨ê²¨ì§„ ì¹´í˜ ì°¾ê¸° <span>(3)</span></button>
        <button class="tag-btn">ğŸš» í™”ì¥ì‹¤ ì²­ê²°í•œ ê³³ ì°¾ê¸° <span>(3)</span></button>
      </div>
    </div>

    <div id="home-search-container_special">
      <h3>ë¶„ìœ„ê¸°ì™€ íŠ¹ì§•</h3>
      <div>
        <button class="tag-btn">âœ¨ ë¶„ìœ„ê¸° ì¢‹ì€ <span>(4)</span></button>
        <button class="tag-btn">ğŸ¡ í•œì˜¥ ê°ì„± <span>(3)</span></button>
        <button class="tag-btn">ğŸ½ï¸ ë¹µì´ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="tag-btn">ğŸ° ì¼€ì´í¬ê°€ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="tag-btn">â˜• ì»¤í”¼ê°€ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="tag-btn">ğŸ“š ê³µë¶€í•˜ê¸° ì¢‹ì€ <span>(4)</span></button>
        <button class="tag-btn">ğŸ›‹ï¸ ì¾Œì í•œ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¶ ì¡°ìš©í•œ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¥‡ ì˜¬íƒ€ì„ ë² ìŠ¤íŠ¸ <span>(3)</span></button>
        <button class="tag-btn">ğŸš€ ì£¼ë§ í”¼í•´ì•¼ í•˜ëŠ” <span>(3)</span></button>
        <button class="tag-btn">ğŸ•µï¸ ìˆ¨ê²¨ì§„ ë‚˜ë§Œì˜ ê³µê°„ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¾ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¥› ìš°ìœ  ë³€ê²½ ê°€ëŠ¥ <span>(3)</span></button>
      </div>
    </div>
  </main>
</div>
<script>
  // Djangoì—ì„œ URL ì´ë¦„ìœ¼ë¡œ ì‹¤ì œ URL ê°€ì ¸ì˜¤ê¸°
  const searchBaseUrl = "{% url 'search' %}";
  const loginUrl = "{% url 'login' %}";

  document.addEventListener('DOMContentLoaded', function () {
    const popup = document.getElementById('home-search-searchSuggestions');
    const searchInput = document.querySelector('.home-search-search-bar');
    const searchForm = document.getElementById('home-search-searchForm');

    let selectedValues = { who: '', what: '', special: '' };

    // âœ… show/hide: 'hidden' â†” 'show'ë§Œ í† ê¸€ (í˜„ì¬ ë§ˆí¬ì—…ê³¼ CSSì— ë§ì¶¤)
    function showSuggestions() {
      if (!popup) return;
      popup.classList.remove('hidden');
      popup.classList.add('show');
    }
    function hideSuggestions() {
      if (!popup) return;
      popup.classList.remove('show');
      popup.classList.add('hidden');
    }

    if (searchInput) {
      // focus ë˜ëŠ” click ì¤‘ ì•„ë¬´ê±°ë‚˜ ì¨ë„ ë¨
      searchInput.addEventListener('focus', (e) => {
        e.stopPropagation();
        showSuggestions();
      });
      searchInput.addEventListener('click', (e) => {
        e.stopPropagation();
        showSuggestions();
      });
    }

    document.addEventListener('click', function (event) {
      if (!popup) return;
      if (!popup.contains(event.target) && event.target !== searchInput) {
        hideSuggestions();
      }
    });

    if (popup) {
      popup.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }

    const categories = {
      'home-search-container_who': 'who',
      'home-search-container_what': 'what',
      'home-search-container_special': 'special',
    };

    // âœ… ë²„íŠ¼ ì„ íƒ: .home-search-tag-btn ë˜ëŠ” .tag-btn ë‘˜ ë‹¤ ì§€ì›
    Object.keys(categories).forEach((categoryId) => {
      const category = document.getElementById(categoryId);
      if (!category) return;

      category.addEventListener('click', function (event) {
        // ë²„íŠ¼/ì´ëª¨ì§€/ìˆ«ì span ì–´ë””ë¥¼ ëˆŒëŸ¬ë„ ë²„íŠ¼ì„ ì°¾ë„ë¡
        const btn = event.target.closest('.home-search-tag-btn, .tag-btn');
        if (!btn || !category.contains(btn)) return;

        event.stopPropagation();

        // ê°™ì€ ê·¸ë£¹ ë‚´ ê¸°ì¡´ ì„ íƒ í•´ì œ
        category
          .querySelectorAll('.home-search-tag-btn.selected, .tag-btn.selected')
          .forEach((b) => b.classList.remove('selected'));

        btn.classList.add('selected');
        selectedValues[categories[categoryId]] = btn.innerText.trim();
      });
    });

    if (searchForm) {
      searchForm.addEventListener('submit', function (event) {
        event.preventDefault();

        const searchQuery = (searchInput?.value || '').trim();
        const queryParams = new URLSearchParams();

        if (searchQuery) queryParams.append('query', searchQuery);
        if (selectedValues.who) queryParams.append('who', selectedValues.who);
        if (selectedValues.what) queryParams.append('what', selectedValues.what);
        if (selectedValues.special) queryParams.append('special', selectedValues.special);

        const finalURL = searchBaseUrl + '?' + queryParams.toString();
        window.top.location.href = finalURL;
      });
    }

    // ë¡œê·¸ì¸ ë²„íŠ¼ ì´ë™ ì˜ˆì‹œ (ìˆì„ ë•Œë§Œ)
    const loginButton = document.getElementById('loginButton');
    if (loginButton) {
      loginButton.addEventListener('click', function () {
        window.location.href = loginUrl;
      });
    }
  });
</script>
