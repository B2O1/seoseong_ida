{% extends "reference.html" %}
{% load static %}
{% load tz %} 
{% block activate %}

<div class="faq-page">
  <div class="faq-card">
    <div class="faq-card-header">
      <h1 class="faq-title">문의사항 목록</h1>

      <div class="faq-actions">
        {% if request.user.is_authenticated %}
          <a href="{% url 'faq_write' %}" class="faq-btn faq-primary">작성</a>
        {% else %}
          <a href="{% url 'login' %}?next={% url 'faq_write' %}" class="faq-btn faq-primary">
            작성(로그인 필요)
          </a>
        {% endif %}
      </div>
    </div>

    {% if not items %}
      <div class="faq-empty">문의 없음</div>
    {% else %}
      <div class="faq-list">
        {% for item in items %}
          <a class="faq-item" href="{% url 'faq_detail' item.pk %}">
            <div class="faq-item-top">
              <span class="faq-chip">
                {{ item.display_type }}
              </span>
              <span class="faq-status">
                {% if item.answer %}답변 완료{% else %}답변 대기{% endif %}
              </span>
            </div>
            <h2 class="faq-item-title">
              {{ item.display_title|truncatechars:40 }}
            </h2>

            <p class="faq-item-preview">
              {{ item.display_body|truncatechars:60 }}
            </p>

            <div class="faq-item-bottom">
              <div class="faq-meta">
                <span>{{ item.name }}</span>
              </div>
              <span class="faq-date">
                {% localtime on %}{{ item.created_at|date:"Y.m.d" }}{% endlocaltime %}
              </span>
            </div>
          </a>
        {% endfor %}
      </div>
            {% if items.paginator.num_pages > 1 %}
      <div class="faq-pagination">
        
        {% if items.has_previous %}
          <a href="?page={{ items.previous_page_number }}" class="page-btn">이전</a>
        {% endif %}

        {% for page_num in items.paginator.page_range %}
          {% if page_num == items.number %}
            <span class="page-btn active">{{ page_num }}</span>
          {% else %}
            <a href="?page={{ page_num }}" class="page-btn">{{ page_num }}</a>
          {% endif %}
        {% endfor %}

        {% if items.has_next %}
          <a href="?page={{ items.next_page_number }}" class="page-btn">다음</a>
        {% endif %}

      </div>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}
