<div class="search-container">
  <form id="searchForm">
    <input class="search-bar" type="text" placeholder="어떤 카페가 좋을까?" />
    <button type="submit">🔍 검색</button>
  </form>

  <main id="searchSuggestions" class="suggestion-box hidden">
    <div id="container_who">
      <h3>누구와 함께 하나요?</h3>
      <div>
        <button class="tag-btn">🧑‍🤝‍🧑 친구랑 <span>(14)</span></button>
        <button class="tag-btn">👩‍❤️‍👨 연인이랑 <span>(14)</span></button>
        <button class="tag-btn">👨‍👩‍👧‍👦 가족이랑 <span>(9)</span></button>
        <button class="tag-btn">🐶 반려동물과 함께 <span>(7)</span></button>
        <button class="tag-btn">👤 혼자서 <span>(7)</span></button>
        <button class="tag-btn">👥 단체로 <span>(4)</span></button>
        <button class="tag-btn">🌍 외국인 친구와 <span>(3)</span></button>
      </div>
    </div>

    <div id="container_what">
      <h3>무엇을 하나요?</h3>
      <div>
        <button class="tag-btn">🍰 디저트 먹기 <span>(14)</span></button>
        <button class="tag-btn">☕ 커피 마시기 <span>(14)</span></button>
        <button class="tag-btn">💻 공부하기 <span>(9)</span></button>
        <button class="tag-btn">📖 책 읽기 <span>(7)</span></button>
        <button class="tag-btn">💬 수다 떨기 <span>(7)</span></button>
        <button class="tag-btn">🏡 한옥 감성 즐기기 <span>(4)</span></button>
        <button class="tag-btn">🐾 반려동물과 함께하기 <span>(3)</span></button>
        <button class="tag-btn">💰 가성비 좋은 곳 찾기 <span>(3)</span></button>
        <button class="tag-btn">🔍 숨겨진 카페 찾기 <span>(3)</span></button>
        <button class="tag-btn">🚻 화장실 청결한 곳 찾기 <span>(3)</span></button>
      </div>
    </div>

    <div id="container_special">
      <h3>분위기와 특징</h3>
      <div>
        <button class="tag-btn">✨ 분위기 좋은 <span>(4)</span></button>
        <button class="tag-btn">🏡 한옥 감성 <span>(3)</span></button>
        <button class="tag-btn">🍽️ 빵이 맛있는 <span>(3)</span></button>
        <button class="tag-btn">🍰 케이크가 맛있는 <span>(3)</span></button>
        <button class="tag-btn">☕ 커피가 맛있는 <span>(3)</span></button>
        <button class="tag-btn">📚 공부하기 좋은 <span>(4)</span></button>
        <button class="tag-btn">🛋️ 쾌적한 <span>(3)</span></button>
        <button class="tag-btn">🎶 조용한 <span>(3)</span></button>
        <button class="tag-btn">🥇 올타임 베스트 <span>(3)</span></button>
        <button class="tag-btn">🚀 주말 피해야 하는 <span>(3)</span></button>
        <button class="tag-btn">🕵️ 숨겨진 나만의 공간 <span>(3)</span></button>
        <button class="tag-btn">🐾 반려동물과 함께 <span>(3)</span></button>
        <button class="tag-btn">🥛 우유 변경 가능 <span>(3)</span></button>
      </div>
    </div>
  </main>
</div>
{% block scripts%}
<script>
  /*function openPopup() {
            var name = '_parent';
            var url = 'home_search.html';
            window.open(url, name);
          }*/
  document.addEventListener('DOMContentLoaded', function () {
    const popup = document.getElementById('searchSuggestions');
    const searchInput = document.querySelector('.search-bar');
    const searchForm = document.getElementById('searchForm'); // 검색 폼 추가

    // 선택된 값 저장 변수
    let selectedValues = {
      who: '',
      what: '',
      special: '',
    };

    // 팝업 열기
    function showSuggestions() {
      if (popup) {
        popup.classList.remove('hidden');
        popup.style.display = 'block';
      }
    }

    // 팝업 닫기 (선택된 버튼 초기화 X)
    function hideSuggestions() {
      if (popup) {
        popup.classList.add('hidden');
        popup.style.display = 'none';
      }
    }

    // 검색창 클릭 시 팝업 열기
    if (searchInput) {
      searchInput.addEventListener('click', function (event) {
        event.stopPropagation();
        showSuggestions();
      });
    }

    // 팝업 바깥을 클릭했을 때 닫기
    document.addEventListener('click', function (event) {
      if (!popup.contains(event.target) && event.target !== searchInput) {
        hideSuggestions();
      }
    });

    // 팝업 내부 클릭 시 닫히지 않도록 방지
    if (popup) {
      popup.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }

    // 모든 카테고리에서 하나의 버튼만 선택 가능하도록 설정
    const categories = {
      container_who: 'who',
      container_what: 'what',
      container_special: 'special',
    };

    Object.keys(categories).forEach((categoryId) => {
      const category = document.getElementById(categoryId);
      if (category) {
        category.addEventListener('click', function (event) {
          if (event.target.classList.contains('tag-btn')) {
            event.stopPropagation();

            // 같은 카테고리의 버튼에서 'selected' 클래스 제거
            category.querySelectorAll('.tag-btn').forEach((btn) => btn.classList.remove('selected'));

            // 클릭한 버튼만 'selected' 클래스 추가
            event.target.classList.add('selected');

            // 선택된 값 저장
            selectedValues[categories[categoryId]] = event.target.innerText.trim();
          }
        });
      }
    });

    // 검색 입력창에서 엔터를 누르거나 검색 버튼을 클릭하면 search.html로 값 전달
    if (searchForm) {
      searchForm.addEventListener('submit', function (event) {
        event.preventDefault(); // 기본 동작 막기

        // 검색어 값 가져오기
        const searchQuery = searchInput.value.trim();
        console.log('🔍 검색어 입력 값:', searchQuery);

        // URL 생성 (검색어 + 선택된 버튼 값)
        const queryParams = new URLSearchParams();
        if (searchQuery) queryParams.append('query', searchQuery);
        if (selectedValues.who) queryParams.append('who', selectedValues.who);
        if (selectedValues.what) queryParams.append('what', selectedValues.what);
        if (selectedValues.special) queryParams.append('special', selectedValues.special);

        const finalURL = 'search.html?' + queryParams.toString();
        console.log('이동할 URL: ', finalURL);

        // 현재 창에서 열기
        window.top.location.href = finalURL;
      });
    }
  });
</script>
{% endblock %}
