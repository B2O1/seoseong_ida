<div class="search-container">
  <form id="searchForm">
    <input class="search-bar" type="text" placeholder="ì–´ë–¤ ì¹´í˜ê°€ ì¢‹ì„ê¹Œ?" />
    <button type="submit">ğŸ” ê²€ìƒ‰</button>
  </form>

  <main id="searchSuggestions" class="suggestion-box hidden">
    <div id="container_who">
      <h3>ëˆ„êµ¬ì™€ í•¨ê»˜ í•˜ë‚˜ìš”?</h3>
      <div>
        <button class="tag-btn">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ì¹œêµ¬ë‘ <span>(14)</span></button>
        <button class="tag-btn">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ ì—°ì¸ì´ë‘ <span>(14)</span></button>
        <button class="tag-btn">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±ì´ë‘ <span>(9)</span></button>
        <button class="tag-btn">ğŸ¶ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ <span>(7)</span></button>
        <button class="tag-btn">ğŸ‘¤ í˜¼ìì„œ <span>(7)</span></button>
        <button class="tag-btn">ğŸ‘¥ ë‹¨ì²´ë¡œ <span>(4)</span></button>
        <button class="tag-btn">ğŸŒ ì™¸êµ­ì¸ ì¹œêµ¬ì™€ <span>(3)</span></button>
      </div>
    </div>

    <div id="container_what">
      <h3>ë¬´ì—‡ì„ í•˜ë‚˜ìš”?</h3>
      <div>
        <button class="tag-btn">ğŸ° ë””ì €íŠ¸ ë¨¹ê¸° <span>(14)</span></button>
        <button class="tag-btn">â˜• ì»¤í”¼ ë§ˆì‹œê¸° <span>(14)</span></button>
        <button class="tag-btn">ğŸ’» ê³µë¶€í•˜ê¸° <span>(9)</span></button>
        <button class="tag-btn">ğŸ“– ì±… ì½ê¸° <span>(7)</span></button>
        <button class="tag-btn">ğŸ’¬ ìˆ˜ë‹¤ ë–¨ê¸° <span>(7)</span></button>
        <button class="tag-btn">ğŸ¡ í•œì˜¥ ê°ì„± ì¦ê¸°ê¸° <span>(4)</span></button>
        <button class="tag-btn">ğŸ¾ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜í•˜ê¸° <span>(3)</span></button>
        <button class="tag-btn">ğŸ’° ê°€ì„±ë¹„ ì¢‹ì€ ê³³ ì°¾ê¸° <span>(3)</span></button>
        <button class="tag-btn">ğŸ” ìˆ¨ê²¨ì§„ ì¹´í˜ ì°¾ê¸° <span>(3)</span></button>
        <button class="tag-btn">ğŸš» í™”ì¥ì‹¤ ì²­ê²°í•œ ê³³ ì°¾ê¸° <span>(3)</span></button>
      </div>
    </div>

    <div id="container_special">
      <h3>ë¶„ìœ„ê¸°ì™€ íŠ¹ì§•</h3>
      <div>
        <button class="tag-btn">âœ¨ ë¶„ìœ„ê¸° ì¢‹ì€ <span>(4)</span></button>
        <button class="tag-btn">ğŸ¡ í•œì˜¥ ê°ì„± <span>(3)</span></button>
        <button class="tag-btn">ğŸ½ï¸ ë¹µì´ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="tag-btn">ğŸ° ì¼€ì´í¬ê°€ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="tag-btn">â˜• ì»¤í”¼ê°€ ë§›ìˆëŠ” <span>(3)</span></button>
        <button class="tag-btn">ğŸ“š ê³µë¶€í•˜ê¸° ì¢‹ì€ <span>(4)</span></button>
        <button class="tag-btn">ğŸ›‹ï¸ ì¾Œì í•œ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¶ ì¡°ìš©í•œ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¥‡ ì˜¬íƒ€ì„ ë² ìŠ¤íŠ¸ <span>(3)</span></button>
        <button class="tag-btn">ğŸš€ ì£¼ë§ í”¼í•´ì•¼ í•˜ëŠ” <span>(3)</span></button>
        <button class="tag-btn">ğŸ•µï¸ ìˆ¨ê²¨ì§„ ë‚˜ë§Œì˜ ê³µê°„ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¾ ë°˜ë ¤ë™ë¬¼ê³¼ í•¨ê»˜ <span>(3)</span></button>
        <button class="tag-btn">ğŸ¥› ìš°ìœ  ë³€ê²½ ê°€ëŠ¥ <span>(3)</span></button>
      </div>
    </div>
  </main>
</div>
{% block scripts%}
<script>
  /*function openPopup() {
            var name = '_parent';
            var url = 'home_search.html';
            window.open(url, name);
          }*/
  document.addEventListener('DOMContentLoaded', function () {
    const popup = document.getElementById('searchSuggestions');
    const searchInput = document.querySelector('.search-bar');
    const searchForm = document.getElementById('searchForm'); // ê²€ìƒ‰ í¼ ì¶”ê°€

    // ì„ íƒëœ ê°’ ì €ì¥ ë³€ìˆ˜
    let selectedValues = {
      who: '',
      what: '',
      special: '',
    };

    // íŒì—… ì—´ê¸°
    function showSuggestions() {
      if (popup) {
        popup.classList.remove('hidden');
        popup.style.display = 'block';
      }
    }

    // íŒì—… ë‹«ê¸° (ì„ íƒëœ ë²„íŠ¼ ì´ˆê¸°í™” X)
    function hideSuggestions() {
      if (popup) {
        popup.classList.add('hidden');
        popup.style.display = 'none';
      }
    }

    // ê²€ìƒ‰ì°½ í´ë¦­ ì‹œ íŒì—… ì—´ê¸°
    if (searchInput) {
      searchInput.addEventListener('click', function (event) {
        event.stopPropagation();
        showSuggestions();
      });
    }

    // íŒì—… ë°”ê¹¥ì„ í´ë¦­í–ˆì„ ë•Œ ë‹«ê¸°
    document.addEventListener('click', function (event) {
      if (!popup.contains(event.target) && event.target !== searchInput) {
        hideSuggestions();
      }
    });

    // íŒì—… ë‚´ë¶€ í´ë¦­ ì‹œ ë‹«íˆì§€ ì•Šë„ë¡ ë°©ì§€
    if (popup) {
      popup.addEventListener('click', function (event) {
        event.stopPropagation();
      });
    }

    // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì—ì„œ í•˜ë‚˜ì˜ ë²„íŠ¼ë§Œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
    const categories = {
      container_who: 'who',
      container_what: 'what',
      container_special: 'special',
    };

    Object.keys(categories).forEach((categoryId) => {
      const category = document.getElementById(categoryId);
      if (category) {
        category.addEventListener('click', function (event) {
          if (event.target.classList.contains('tag-btn')) {
            event.stopPropagation();

            // ê°™ì€ ì¹´í…Œê³ ë¦¬ì˜ ë²„íŠ¼ì—ì„œ 'selected' í´ë˜ìŠ¤ ì œê±°
            category.querySelectorAll('.tag-btn').forEach((btn) => btn.classList.remove('selected'));

            // í´ë¦­í•œ ë²„íŠ¼ë§Œ 'selected' í´ë˜ìŠ¤ ì¶”ê°€
            event.target.classList.add('selected');

            // ì„ íƒëœ ê°’ ì €ì¥
            selectedValues[categories[categoryId]] = event.target.innerText.trim();
          }
        });
      }
    });

    // ê²€ìƒ‰ ì…ë ¥ì°½ì—ì„œ ì—”í„°ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ search.htmlë¡œ ê°’ ì „ë‹¬
    if (searchForm) {
      searchForm.addEventListener('submit', function (event) {
        event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë§‰ê¸°

        // ê²€ìƒ‰ì–´ ê°’ ê°€ì ¸ì˜¤ê¸°
        const searchQuery = searchInput.value.trim();
        console.log('ğŸ” ê²€ìƒ‰ì–´ ì…ë ¥ ê°’:', searchQuery);

        // URL ìƒì„± (ê²€ìƒ‰ì–´ + ì„ íƒëœ ë²„íŠ¼ ê°’)
        const queryParams = new URLSearchParams();
        if (searchQuery) queryParams.append('query', searchQuery);
        if (selectedValues.who) queryParams.append('who', selectedValues.who);
        if (selectedValues.what) queryParams.append('what', selectedValues.what);
        if (selectedValues.special) queryParams.append('special', selectedValues.special);

        const finalURL = 'search.html?' + queryParams.toString();
        console.log('ì´ë™í•  URL: ', finalURL);

        // í˜„ì¬ ì°½ì—ì„œ ì—´ê¸°
        window.top.location.href = finalURL;
      });
    }
  });
</script>
{% endblock %}
