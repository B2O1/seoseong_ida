<!-- {% load static %}

<!DOCTYPE html>
<html>
<head>
    <title>findbymap</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/findbymap.css' %}" />
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=dkm4t7wo8m&submodules=geocoder"></script>
</head>
<body>
<div id="map" style="width:80%;height:100%;"></div>

<div class="info-layers" id="info-boxes">
</div>

<script>
  const seoul = new naver.maps.LatLngBounds(
    new naver.maps.LatLng(37.413294,126.734086),
    new naver.maps.LatLng(37.715133,127.269311)
  );

  const map = new naver.maps.Map('map', {
    center: new naver.maps.LatLng(37.5665,126.9780),
    zoom: 12,
    minZoom: 10,
    maxZoom: 15,
    maxBounds: seoul
  });

  const storeName = prompt('찾고 싶은 가게(주소/건물명)를 입력하세요:');
  const boxContainer = document.getElementById('info-boxes');

  if (!storeName) {
    console.log('입력 없음');
  } else {
    naver.maps.Service.geocode({ query: storeName }, (status, res) => {
      if (status !== naver.maps.Service.Status.OK) {
        alert('주소 검색 실패: ' + status);
        return;
      }

      const items = res.v2.addresses || [];
      if (!items.length) {
        alert('검색 결과가 없습니다.');
        return;
      }

      const a = items[0];
      const lat = parseFloat(a.y), lng = parseFloat(a.x);
      const pos = new naver.maps.LatLng(lat, lng);

      const marker = new naver.maps.Marker({ map, position: pos, title: storeName });

      const makeInfoHTML = (name, addrRoad, addrJibun) => `
        <div style="padding:8px 10px;max-width:260px">
          <div style="font-weight:600;margin-bottom:4px">${name || '검색 결과'}</div>
          ${addrRoad ? `<div style="font-size:12px;color:#444">도로명: ${addrRoad}</div>` : ''}
          ${addrJibun ? `<div style="font-size:12px;color:#666">지번: ${addrJibun}</div>` : ''}
          <div style="font-size:12px;color:#888;margin-top:6px">(${lat.toFixed(6)}, ${lng.toFixed(6)})</div>
        </div>
      `;

      const infoWin = new naver.maps.InfoWindow({
        content: makeInfoHTML(
          storeName,
          a.roadAddress || a.englishAddress || '',
          a.jibunAddress || ''
        )
      });

      naver.maps.Event.addListener(marker, 'click', () => {
        infoWin.getMap() ? infoWin.close() : infoWin.open(map, marker);
      });

      infoWin.open(map, marker);
      map.setCenter(pos);
      map.setZoom(16);

      // 오른쪽 info-box 갱신
      boxContainer.innerHTML = ''; // 기존 지우기

      const box = document.createElement('div');
      box.className = 'info-box';
      box.innerHTML = `
        <div class="store-name">${storeName}</div>
        <div class="store-desc">${a.roadAddress || a.jibunAddress || '주소 없음'}</div>
      `;
      boxContainer.appendChild(box);
    });
  }
</script>
</body>
</html> -->